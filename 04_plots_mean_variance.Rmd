---
title: "04_plots_mean_variance"
output: html_document
date: "2025-11-21"
---

```{r mean var curves}

rmarkdown::render("04_mean_and_variance_functions.Rmd", envir = globalenv(), quiet = TRUE)

grid <- seq(min(Time), max(Time), length.out = 500)

subgroups <- list(
  Males   = grep("^Males", groups_names),
  Females = grep("^Females", groups_names),
  WT      = grep(" WT ", groups_names),
  HRM     = grep(" HRM ", groups_names)
)

```




```{r mean curves}

if (!dir.exists("figures_mu_curve")) dir.create("figures_mu_curve")

ylim_mean <- range(unlist(mean_values_list))

plot_mean_functions <- function(grid, mean_values, group_names, colors, lty, ylim, filename, main_title) {
  png(filename, width = 1500, height = 1000, res = 150)
  
  par(mar = c(5, 4, 4, 10))  

  plot(grid, mean_values[[1]], type="n", ylim=ylim,
       xlab="Time (sec)", ylab="fEPSP % of baseline",
       main = main_title)

  for (i in seq_along(mean_values)) {
    lines(grid, mean_values[[i]], col=colors[i], lty=lty[i], lwd=2)
  }

  grid()
  legend("topright", inset=c(-0.27,0), xpd=TRUE,
         legend=group_names, col=colors, lty=lty, lwd=2, bty="n", cex=0.8)

  dev.off()
}



for (sg in names(subgroups)) {
  idx <- subgroups[[sg]]
  
  plot_mean_functions(
    grid,
    mean_values_list[idx],
    groups_names[idx],
    colors[idx],
    lty[idx],
    ylim_mean,
    paste0("figures_mu_curve/mean_function_curves_", tolower(sg), ".png"),
    paste("Mean function curve —", sg)
  )
}


```




```{r var curves}

if (!dir.exists("figures_var_curve")) dir.create("figures_var_curve")


var_values_list_aligned <- lapply(var_values_list, function(v) {
  
  approx(x = seq_along(v),        
         y = v,                   
         xout = seq(1, length(v), length.out = length(grid)))$y
})


ylim_var <- range(unlist(var_values_list_aligned), na.rm = TRUE)


plot_function_curve <- function(grid, values_list, group_names, colors, lty, ylim,
                                filename, main_title, ylab="Value") {
  png(filename, width = 1500, height = 1000, res = 150)
  par(mar = c(5, 4, 4, 10))  

  plot(grid, values_list[[1]], type="n", ylim=ylim,
       xlab="Time (sec)", ylab=ylab, main=main_title)

  for (i in seq_along(values_list)) {
    lines(grid, values_list[[i]], col=colors[i], lty=lty[i], lwd=2)
  }

  grid()
  legend("topright", inset = c(-0.27,0), xpd = TRUE,
         legend = group_names, col = colors, lty = lty, lwd = 2, bty = "n", cex = 0.8)

  dev.off()
}


for (sg in names(subgroups)) {
  idx <- subgroups[[sg]]
  
  plot_function_curve(
    grid,
    var_values_list_aligned[idx],
    groups_names[idx],
    colors[idx],
    lty[idx],
    ylim = ylim_var,
    filename = paste0("figures_var_curve/var_function_curves_", tolower(sg), ".png"),
    main_title = paste("Variance function curve —", sg),
    ylab = "Variance"
  )
}

```




