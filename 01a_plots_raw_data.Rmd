---
title: "raw discret data - group discrete curves"
output: html_document
date: "2025-11-21"
---

```{r plots raw data}


rmarkdown::render("01a_data_preparation.Rmd", envir = globalenv(), quiet = TRUE)

#Function to compute mean & SEM (raw data)

compute_mean_sem_raw <- function(mat) {
  mean_curve <- apply(mat, 1, mean, na.rm = TRUE)
  
  sem_curve <- apply(mat, 1, function(x) {
    sd(x, na.rm = TRUE) / sqrt(sum(!is.na(x)))
  })
  
  list(mean = mean_curve, sem = sem_curve)
}


# Compute global Y-limits for all groups (same scale)

grid <- Time  # X-axis vector

all_vals <- unlist(
  lapply(all_groups, function(mat) {
    stats <- compute_mean_sem_raw(mat)
    c(stats$mean - stats$sem, stats$mean + stats$sem)
  })
)

ylim_global <- range(all_vals)


# Plot mean Â± SEM for all groups

if(!dir.exists("figures_raw_data")) dir.create("figures_raw_data")

for (i in seq_along(all_groups)) {
  
  stats <- compute_mean_sem_raw(all_groups[[i]])
  
  mean_curve <- stats$mean
  sem_curve  <- stats$sem
  
  # output file name 
  file_name <- paste0("figures_raw_data/", groups_names[i], ".png")
  
  
  png(filename = file_name, width = 1200, height = 800, res = 150)

  # Colors
  point_col   <- "black"                         # points always black
  whisker_col <- adjustcolor(colors[i], 0.9)     # whiskers in group color
  
  # Plot mean points only (no lines)
  plot(grid, mean_curve,
       type="p", pch=16, cex=0.9,
       col=point_col,
       ylim = ylim_global,
       xlab = "Time (sec)",
       ylab = "fEPSP (% baseline)",
       main = groups_names[i])
  
  # Compute cap width automatically (small horizontal whisker caps)
  cap_width <- diff(range(grid)) / 200
  
  # ---- SEM whiskers (vertical) ----
  segments(grid,
           mean_curve - sem_curve,
           grid,
           mean_curve + sem_curve,
           col = whisker_col,
           lwd = 2)
  
  # ---- SEM whisker caps ----
  segments(grid - cap_width,
           mean_curve - sem_curve,
           grid + cap_width,
           mean_curve - sem_curve,
           col = whisker_col,
           lwd = 2)
  
  segments(grid - cap_width,
           mean_curve + sem_curve,
           grid + cap_width,
           mean_curve + sem_curve,
           col = whisker_col,
           lwd = 2)
  
  # Reference line at 150%
  abline(h = 150, col = "black", lty = 2, lwd = 2)
  
  # Background grid
  grid()
  
  dev.off()

}
```






