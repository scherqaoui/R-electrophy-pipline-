---
title: "apply fanova"
output: html_document
date: "2025-11-24"
---

```{r apply fanova}

rmarkdown::render("01a_data_preparation.Rmd", envir = globalenv(), quiet = TRUE)
rmarkdown::render("01b_data_preparation.Rmd", envir = globalenv(), quiet = TRUE)
rmarkdown::render("02_local_outlier_handling.Rmd", envir = globalenv(), quiet = TRUE)
rmarkdown::render("04_mean_and_variance_functions.Rmd", envir = globalenv(), quiet = TRUE)
rmarkdown::render("07_functional_anova.Rmd", envir = globalenv(), quiet = TRUE)

set.seed(1234)


# Suppose having n functional observations (each in fd_groups[[i]]).  we define:

Genotype <- c("WT","HRM","WT","HRM", 
          "WT","HRM","WT","HRM",
          "WT","HRM","WT","HRM",
          "WT","HRM","WT","HRM")

Age  <- c("juv","juv","juv","juv",
          "ado","ado","ado","ado", 
          "adu", "adu","adu", "adu",
          "age", "age","age", "age")

Sex <- c("M","M","F","F",
          "M","M","F","F",
          "M","M","F","F",
          "M","M","F","F")

# Run 3-way functional ANOVA
res3 <- fanova3_FP(fd_groups, Genotype, Age, Sex, P = 2000)

# Extract
fstats <- res3$stat
dfs    <- res3$df
eta2   <- res3$effect_size_eta

# Choose which p-values to report:
#pvals <- res3$pvalue_maxT    # <-- recommended
#pvals <- res3$pvalue_unadj # (if we want unadjusted)
#pvals <- res3$pvalue_BH    # (if we want FDR)
p_value <- res3$pvalue_holm 

anova_table3 <- data.frame(
  Factor      = c("Genotype","Age","Sex","Genotype:Age","Genotype:Sex","Age:Sex","Genotype:Age:Sex"),
  F_stat      = c(fstats["FG"], fstats["FA"], fstats["FS"],
                  fstats["FAG"], fstats["FGS"], fstats["FAS"],
                  fstats["FGAS"]),
  p_value     = c(pvals["FG"],  pvals["FA"],  pvals["FS"],
                  pvals["FAG"], pvals["FGS"], pvals["FAS"],
                  pvals["FGAS"]),
  df_numer    = c(dfs["dfG"],   dfs["dfA"],   dfs["dfS"],
                  dfs["dfAG"],  dfs["dfGS"],  dfs["dfAS"],
                  dfs["dfGAS"]),
  eta2_effect = c(eta2["eta2_G"], eta2["eta2_A"], eta2["eta2_S"],
                  eta2["eta2_AG"], eta2["eta2_GS"], eta2["eta2_AS"],
                  eta2["eta2_GAS"])
)

print(anova_table3)

```












