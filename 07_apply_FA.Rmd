---
title: "apply fanova"
output: html_document
date: "2025-11-24"
---

```{r apply fanova}

rmarkdown::render("01a_data_preparation.Rmd", envir = globalenv(), quiet = TRUE)
rmarkdown::render("01b_data_preparation.Rmd", envir = globalenv(), quiet = TRUE)
rmarkdown::render("02_local_outlier_handling.Rmd", envir = globalenv(), quiet = TRUE)
rmarkdown::render("04_mean_and_variance_functions.Rmd", envir = globalenv(), quiet = TRUE)
rmarkdown::render("07_functional_anova.Rmd", envir = globalenv(), quiet = TRUE)

set.seed(1234)


# Suppose having n functional observations (each in fd_groups[[i]]).  we define:

Genotype <- c("WT","HRM","WT","HRM", 
          "WT","HRM","WT","HRM",
          "WT","HRM","WT","HRM",
          "WT","HRM","WT","HRM")

Age  <- c("juv","juv","juv","juv",
          "ado","ado","ado","ado", 
          "adu", "adu","adu", "adu",
          "age", "age","age", "age")

Sex <- c("M","M","F","F",
          "M","M","F","F",
          "M","M","F","F",
          "M","M","F","F")

# Runing the 3-way functional ANOVA (with 2 000 permutations):
res3 <- fanova3_FP(fd_groups, Genotype, Age, Sex, P = 2000)

# Extracting results:
fstats     <- res3$stat       # FG, FA, FS, FAG, FGS, FAS, FGAS
pvals      <- res3$pvalue
dfs        <- res3$df
eta2       <- res3$effect_size_eta

# A small ANOVA table:
anova_table3 <- data.frame(
  Factor      = c("Genotype","Age","Sex","Genotype:Age","Genotype:Sex","Age:Sex","Genotype:Age:Sex"),
  F_stat      = c(fstats["FG"],    fstats["FA"],    fstats["FS"],
                  fstats["FAG"],   fstats["FGS"],   fstats["FAS"],
                  fstats["FGAS"]),
  p_value     = c(pvals["pG"],     pvals["pA"],     pvals["pS"],
                  pvals["pAG"],    pvals["pGS"],    pvals["pAS"],
                  pvals["pGAS"]),
  df_numer    = c(dfs["dfG"],      dfs["dfA"],      dfs["dfS"],
                  dfs["dfAG"],     dfs["dfGS"],     dfs["dfAS"],
                  dfs["dfGAS"]),
  #df_denom    = rep(dfs["dfE"], 7),
  eta2_effect = c(eta2["eta2_G"],  eta2["eta2_A"],  eta2["eta2_S"],
                  eta2["eta2_AG"], eta2["eta2_GS"], eta2["eta2_AS"],
                  eta2["eta2_GAS"])
)

print(anova_table3)


if (!dir.exists("results_tables")) dir.create("results_tables")

library(gridExtra)

png("results_tables/anova_table3.png", width = 1600, height = 600, res = 150)
grid.table(anova_table3)
dev.off()


```












