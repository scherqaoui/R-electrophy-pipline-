---
title: "Smoothed Functional Data â€” Group Curves"
output: html_document
date: "2025-11-21"
---

```{r plots fd data}

rmarkdown::render("01a_data_preparation.Rmd", envir = globalenv(), quiet = TRUE)
rmarkdown::render("01b_data_preparation.Rmd", envir = globalenv(), quiet = TRUE)


#-------------------------Plot group's curves------------------------


grid <- seq(min(Time), max(Time), length.out = 200)

all_vals <- unlist(lapply(all_fd_groups, function(fd) eval.fd(grid, fd)))
ylim_global <- range(all_vals)
ylim_global


plot_gp_curves <- function(fd_gp, title_gp, col, lty,
                         ylim_global = NULL) {
  
  
  grid <- seq(min(Time), max(Time), length.out = 200)
  mat  <- eval.fd(grid, fd_gp)    
  
  #first curves
  plot(grid, mat[, 1],type='l', col = col,lty=lty, lwd = 2,
       main = title_gp, xlab = "Time (sec)", ylab = "fESPS % of baseline",
       ylim = ylim_global)
  
  #adding the other curves of the group
  if (ncol(mat) > 1) {
    for (i in 2:ncol(mat)) {
      lines(grid, mat[, i],lty= lty, col = col, lwd = 2)
    }
  }
}

if (!dir.exists("figures_smooth_data")) dir.create("figures_smooth_data")

for (i in 1:length(all_fd_groups)) {
  
  file_name <- paste0("figures_smooth_data/", groups_names[i], ".png")
  
  png(filename = file_name, width = 1200, height = 800, res = 150)
  
  plot_gp_curves(
    fd_gp = all_fd_groups[[i]],
    title_gp = groups_names[i],
    col = colors[i],
    lty =lty[i],
    ylim_global = ylim_global
    
    
  )
  abline(h = 150, col = "black", lwd = 2, lty = 2)
  grid()
  
  dev.off()
}

```








```{r plot functional boxplot}

plot_boxplot <- function(fd_gp, title_gp, col, lty,
                         ylim_global = NULL) {
  
  
  fbplot(fd_gp,method='MBD',ylim= ylim_global )
}

if (!dir.exists("figures_boxplot_data")) dir.create("figures_boxplot_data")

for (i in 1:length(all_fd_groups)) {
  
  file_name <- paste0("figures_boxplot_data/", groups_names[i], ".png")
  
  png(filename = file_name, width = 1200, height = 800, res = 150)
  
  plot_boxplot(
    fd_gp = all_fd_groups[[i]],
    title_gp = groups_names[i],
    col = colors[i],
    lty =lty[i],
    ylim_global = ylim_global
    
    
  )
  
  grid()
  
  dev.off()
}


```












