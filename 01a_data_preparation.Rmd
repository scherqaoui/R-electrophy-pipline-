---
title: "data preparation"
output: html_document
date: "2025-11-20"
---




```{r raw data}

library(fda)
library(fda.usc)
library(readxl)
library(dplyr)
library(tidyr)
library(fdANOVA)
library(zoo)

#Raw electrophysiology Excel sheets
data_juv <- read_excel("C:/Users/bs/Desktop/R-electrophy-pipline-/all data.xlsx", sheet = "juv")
data_ado <- read_excel("C:/Users/bs/Desktop/R-electrophy-pipline-/all data.xlsx", sheet = "ado")
data_adu <- read_excel("C:/Users/bs/Desktop/R-electrophy-pipline-/all data.xlsx", sheet = "adu")
#data_age <- read_excel("C:/Users/bs/Desktop/R-electrophy-pipline-/all data.xlsx", sheet = "age")



#Removes unused rows/columns
clean_data <- function(data, time_min, time_max, drop_cols, method = c("linear", "spline")) {
  method <- match.arg(method)
  data <- data[, -drop_cols]
  colnames(data) <- as.character(unlist(data[5, ]))
  data <- data[-c(1:6), ]
  colnames(data)[1] <- "Time"
  data$Time <- as.numeric(data$Time)
  data[-1] <- lapply(data[-1], as.numeric)
  
  
  data <- data %>% filter(Time >= time_min & Time <= time_max)
  
  # Replace NA by interpolation
  data[-1] <- lapply(data[-1], function(x) {
    if (method == "linear") {
      na.approx(x, x = data$Time, na.rm = FALSE, rule = 2)  # linear interpolation
    } else {
      na.spline(x, x = data$Time)                # spline interpolation
    }
  })
  
  return(data)

}


cleaned_data_juv <- clean_data(data_juv, 10, 2400, c(1:4,6,15,26:32,43,44), method = "linear")
cleaned_data_ado <- clean_data(data_ado, 10, 2400, c(1:4,16,23,26,37), method = "linear")
cleaned_data_adu <- clean_data(data_adu, 10, 2400, c(1:4,6,11,17,20,28,29,36,38,39,43), method = "linear")
#cleaned_data_age <- clean_data(data_age, 10, 2390, c(1:4,6,11,13,14))


Time <- cleaned_data_juv$Time

matrix_juv <- as.matrix(cleaned_data_juv[, -1]) 
matrix_ado <- as.matrix(cleaned_data_ado[, -1]) 
matrix_adu <- as.matrix(cleaned_data_adu[, -1]) 
#matrix_age <- as.matrix(cleaned_data_age[, -1]) 



#Splits each dataset into biologically meaningful subgroups

all_groups <- list(
  # Juvenile
  malesWTjuv    = matrix_juv[, 1:8],
  malesHRMjuv   = matrix_juv[, 9:18],
  femalesWTjuv  = matrix_juv[, 19:28],
  femalesHRMjuv = matrix_juv[, 29:40],

  # Adolescent
  malesWTado    = matrix_ado[, 1:10],
  malesHRMado   = matrix_ado[, 11:18],
  femalesWTado  = matrix_ado[, 19:28],
  femalesHRMado = matrix_ado[, 29:37],

  # Adult
  malesWTadu    = matrix_adu[, 1:9],
  malesHRMadu   = matrix_adu[, 10:18],
  femalesWTadu  = matrix_adu[, 19:25],
  femalesHRMadu  = matrix_adu[, 26:33]
  
  # Age
  #malesWTage    = matrix_age[, 1:5]
  #malesHRMage   = matrix_adu[, 10:18],
  #femalesWTage  = matrix_adu[, 19:25],
  #femalesHRMage  = matrix_adu[, 26:33],
  
)


#Metadata

groups_names <- c(
  "Males WT Juvenile","Males HRM Juvenile","Females WT Juvenile","Females HRM Juvenile",
  "Males WT Adolescent","Males HRM Adolescent","Females WT Adolescent","Females HRM Adolescent","Males WT Adult","Males HRM Adult","Females WT Adult", "Females HRM Adult"
  #"Males WT age"
  )



colors <- c(
    # Juvenile 
   "#00427A","#00427A","#4F8FD3","#4F8FD3",  
    # Adolescent 
   "yellow3", "yellow3","#DC5700","#DC5700",  
    # Adult 
   "green3","green3","#1F7F1F","#1F7F1F"
   #age
   #"red2"
  
)   


lty <- c(1,2,1,2, 1,2,1,2, 1,2,1,2
         #1
         )



```















