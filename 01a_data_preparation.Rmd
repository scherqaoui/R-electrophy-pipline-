---
title: "data preparation"
output: html_document
date: "2025-11-20"
---




```{r raw data}

library(fda)
library(fda.usc)
library(readxl)
library(dplyr)
library(tidyr)
library(fdANOVA)
library(zoo)
library(gridExtra)
library(grid)
library(RColorBrewer)

#Raw electrophysiology Excel sheets
data_juv <- read_excel("C:/Users/bs/Desktop/R-electrophy-pipline-/all data.xlsx", sheet = "juv")
data_ado <- read_excel("C:/Users/bs/Desktop/R-electrophy-pipline-/all data.xlsx", sheet = "ado")
data_adu <- read_excel("C:/Users/bs/Desktop/R-electrophy-pipline-/all data.xlsx", sheet = "adu")
data_age <- read_excel("C:/Users/bs/Desktop/R-electrophy-pipline-/all data.xlsx", sheet = "age")


#Removes unused rows/columns
clean_data <- function(data, time_min, time_max, drop_cols, method = c("linear", "spline")) {
  method <- match.arg(method)
  
  #  Remove specified columns
  drop_cols <- drop_cols[drop_cols <= ncol(data)]
  data <- data[, -drop_cols]
  
  #  Use row 5 as header
  new_names <- as.character(unlist(data[5, ]))
  new_names <- make.names(new_names, unique = TRUE)
  colnames(data) <- new_names
  
  # Remove header rows
  data <- data[-c(1:6), ]
  colnames(data)[1] <- "Time"
  
  # Convert Time to numeric
  data$Time <- suppressWarnings(as.numeric(data$Time))
  
  # Clean non-numeric symbols before numeric conversion
  data[-1] <- lapply(data[-1], function(x) {
    x <- gsub(",", ".", x)                   # replace commas
    x[x %in% c("", " ", "NA", "na", "-", "--")] <- NA
    suppressWarnings(as.numeric(x))
  })
  
  # Keep time window
  data <- data %>% filter(Time >= time_min, Time <= time_max)
  
  # Interpolate NA
  data[-1] <- lapply(data[-1], function(x) {
    if (method == "linear") {
      na.approx(x, x = data$Time, na.rm = FALSE, rule = 2)
    } else {
      na.spline(x, x = data$Time)
    }
  })
  
  return(data)
}


cleaned_data_juv <- clean_data(data_juv, 10, 2400, c(1:4,6,15,26:32,43,44), method = "linear")
cleaned_data_ado <- clean_data(data_ado, 10, 2400, c(1:4,16,23,26,37), method = "linear")
cleaned_data_adu <- clean_data(data_adu, 10, 2400, c(1:4,6,11,17,20,28,29,36,38,39,43), method = "linear")
cleaned_data_age <- clean_data(data_age, 10, 2400, c(1:4,6,13:16,24,31), method = "linear")


Time <- cleaned_data_juv$Time

matrix_juv <- as.matrix(cleaned_data_juv[, -1]) 
matrix_ado <- as.matrix(cleaned_data_ado[, -1]) 
matrix_adu <- as.matrix(cleaned_data_adu[, -1]) 
matrix_age <- as.matrix(cleaned_data_age[, -1]) 


#Splits each dataset into biologically meaningful subgroups

all_groups <- list(
  # Juvenile
  malesWTjuv    = matrix_juv[, 1:8],  malesHRMjuv   = matrix_juv[, 9:18],
  femalesWTjuv  = matrix_juv[, 19:28],femalesHRMjuv = matrix_juv[, 29:40],

  # Adolescent
  malesWTado    = matrix_ado[, 1:10], malesHRMado   = matrix_ado[, 11:18],
  femalesWTado  = matrix_ado[, 19:28],femalesHRMado = matrix_ado[, 29:37],

  # Adult
  malesWTadu    = matrix_adu[, 1:9],   malesHRMadu   = matrix_adu[, 10:18],
  femalesWTadu  = matrix_adu[, 19:25],femalesHRMadu  = matrix_adu[, 26:33],
  
  # Age
  malesWTage    = matrix_age[, 1:6],   malesHRMage   = matrix_age[, 7:13],
  femalesWTage  = matrix_age[, 14:19],femalesHRMage  = matrix_age[, 20:25]
)


#Metadata

groups_names <- c(
  "Males WT Juvenile","Males HRM Juvenile","Females WT Juvenile","Females HRM Juvenile",         #Juvenile
  "Males WT Adolescent","Males HRM Adolescent","Females WT Adolescent","Females HRM Adolescent", #Adolescent
  "Males WT Adult","Males HRM Adult","Females WT Adult", "Females HRM Adult",                    #Adult
  "Males WT Aged", "Males HRM Aged", "Females WT Aged", "Females HRM Aged"                      #aged
  
  )



colors <- c(
    
   "#00427A","#00427A","#4F8FD3","#4F8FD3",   # Juvenile 
   "yellow3","yellow3","#DC5700","#DC5700",  # Adolescent 
   "green3","green3","#1F7F1F","#1F7F1F",     # Adult
   "red2","red","purple","purple"            #Aged
   
  
  
)   


lty <- c(1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2)



```














